<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Summary Report</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }

        h1, h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        table {
            margin-bottom: 30px;
        }

        th {
            width: 30%;
            background-color: #f1f1f1;
        }

        td, th {
            padding: 10px !important;
        }

        .section {
            margin-bottom: 40px;
        }

        /* Prevent table from breaking across pages */
        table, tr, td, th {
            page-break-inside: avoid !important;
            break-inside: avoid !important;
        }

        .section {
            page-break-inside: avoid !important;
            break-inside: avoid !important;
        }

        h2, h5 {
            page-break-after: avoid !important;
        }
    </style>
</head>
<body>
    <div class="container" id="content">
        <h1>User Summary Report</h1>
        <p class="text-center">Loading data...</p>
    </div>

    <!-- html2pdf CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>
        const API_URL = 'https://ff.mainstream.co.in/api/user/2';

        fetch(API_URL)
            .then(response => response.json())
            .then(data => {
                const root = data.awaken;
                const personal = root.awareness.personalDetails;
                const spouse = root.awareness.maritalDetails.spouseDetails;
                const children = root.awareness.maritalDetails.childrenDetails;
                const goals = root.wings.selectedForms;

                const contentDiv = document.getElementById("content");
                contentDiv.innerHTML = `
                        <h1>User Summary Report</h1>

                        <div class="section">
                            <h2>Personal Details</h2>
                            <div class="table-responsive">
                                <table class="table table-bordered table-striped">
                                    <tr><th>Name</th><td>${personal.name}</td></tr>
                                    <tr><th>Gender</th><td>${personal.gender}</td></tr>
                                    <tr><th>DOB</th><td>${personal.dob}</td></tr>
                                    <tr><th>Phone</th><td>${personal.phone}</td></tr>
                                    <tr><th>Email</th><td>${personal.email}</td></tr>
                                    <tr><th>Aadhaar</th><td>${personal.aadhaar}</td></tr>
                                    <tr><th>PAN</th><td>${personal.pan}</td></tr>
                                </table>
                            </div>
                        </div>

                        <div class="section">
                            <h2>Spouse Details</h2>
                            <div class="table-responsive">
                                <table class="table table-bordered table-striped">
                                    <tr><th>Name</th><td>${spouse.spouseName}</td></tr>
                                    <tr><th>DOB</th><td>${spouse.spouseDob}</td></tr>
                                    <tr><th>Phone</th><td>${spouse.spousePhone}</td></tr>
                                    <tr><th>Email</th><td>${spouse.spouseEmail}</td></tr>
                                    <tr><th>PAN</th><td>${spouse.spousePan}</td></tr>
                                </table>
                            </div>
                        </div>

                        <div class="section">
                            <h2>Children Details</h2>
                            ${children.map((child, index) => `
                                <div class="mb-3">
                                    <h5>Child ${index + 1}</h5>
                                    <div class="table-responsive">
                                        <table class="table table-bordered table-striped">
                                            <tr><th>Name</th><td>${child.childName}</td></tr>
                                            <tr><th>DOB</th><td>${child.childDob}</td></tr>
                                            <tr><th>Phone</th><td>${child.childPhone}</td></tr>
                                            <tr><th>Email</th><td>${child.childEmail}</td></tr>
                                            <tr><th>PAN</th><td>${child.childPan}</td></tr>
                                        </table>
                                    </div>
                                </div>
                            `).join('')}
                        </div>

                        <div class="section">
                            <h2>Selected Goals</h2>
                            ${goals.map((goal, index) => `
                                <div class="mb-3">
                                    <h5>Goal ${index + 1}</h5>
                                    <div class="table-responsive">
                                        <table class="table table-bordered table-striped">
                                            <tr><th>Goal</th><td>${goal.goal}</td></tr>
                                            <tr><th>Start Year</th><td>${goal.goalStartYear}</td></tr>
                                            <tr><th>Plan Year</th><td>${goal.goalPlanYear}</td></tr>
                                            <tr><th>Priority</th><td>${goal.priority}</td></tr>
                                        </table>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;

                //setTimeout(() => {
                //    html2pdf().from(contentDiv).save('User-Summary.pdf');
                //}, 2000);

                setTimeout(() => {
                    const opt = {
                        margin: 0.5,
                        filename: 'User-Summary.pdf',
                        image: { type: 'jpeg', quality: 0.98 },
                        html2canvas: { scale: 2 },
                        jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' },
                        pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
                    };

                    html2pdf().set(opt).from(contentDiv).save();
                }, 2000);


            })
            .catch(err => {
                document.getElementById("content").innerHTML = "<p class='text-danger'>Error loading data.</p>";
                console.error("Fetch error:", err);
            });
    </script>
</body>
</html>
